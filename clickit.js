class ClickIt{constructor(options){this.initial={trigger:".js-clickit",sync:null,mode:null,delay:0,openDelay:null,closeDelay:null,height:false,closeOther:false,readyClass:"js-clickit-ready",openClass:"js-clickit-opening",closeClass:"js-clickit-closing",lockClass:"js-clickit-lock"};this.settings=Object.assign(this.initial,options);if(!this.settings.openDelay||isNaN(this.settings.openDelay)){this.settings.openDelay=this.settings.delay}if(!this.settings.closeDelay||isNaN(this.settings.closeDelay)){this.settings.closeDelay=this.settings.delay}if(this.settings.mode==="tab"){this.settings.closeOther=true}this.controls=[];this.syncs=[];this.triggers=document.querySelectorAll(this.settings.trigger);if(this.triggers){return false}}init=()=>{this.triggers.forEach((trigger,i)=>{let key=i;let control_id=trigger.getAttribute("aria-controls");control_id=!control_id?trigger.hash.replace(/^#/,""):control_id;if(!control_id){return false}this.controls[key]=document.getElementById(control_id);if(!this.controls[key]){return false}if(this.settings.mode==="popup"||this.settings.mode==="modal"){trigger.setAttribute("aria-haspopup","true")}if(this.settings.mode==="tab"){trigger.setAttribute("role","tab")}trigger.setAttribute("aria-controls",control_id);if(trigger.getAttribute("aria-expanded")==="true"){this.controls[key].setAttribute("aria-hidden",false);if(this.settings.mode==="tab"){trigger.setAttribute("aria-selected","true")}}else{trigger.setAttribute("aria-expanded",false);this.controls[key].setAttribute("aria-hidden",true);if(this.settings.mode==="tab"){trigger.setAttribute("aria-selected","false")}}if(this.settings.height===true){this.setHeight(key)}this.controls[key].classList.add(this.settings.readyClass);let sync_selector=this.settings.sync?this.settings.sync:trigger.dataset.clickitSync;this.syncs[key]=sync_selector?document.querySelectorAll(sync_selector):[];trigger.addEventListener("click",e=>{this.afterClick(e.currentTarget,key,trigger,this.controls[key],this.syncs[key])});if(this.syncs[key]&&this.syncs[key].length>0){this.syncs[key].forEach(sync=>{sync.setAttribute("aria-controls",control_id);sync.addEventListener("click",e=>{this.afterClick(e.currentTarget,key,trigger,this.controls[key],this.syncs[key])});if(this.settings.mode==="popup"||this.settings.mode==="modal"){sync.setAttribute("aria-haspopup","true")}})}if(this.settings.height===true){window.addEventListener("resize",()=>{this.setHeight(key)})}})};afterClick=(currentTarget,key,trigger,control,sync)=>{if(currentTarget.classList.contains(this.settings.lockClass)){return false}if(this.settings.closeOther===true){this.closeOther(key)}if(this.settings.mode==="modal"){currentTarget.blur()}if(currentTarget.getAttribute("aria-expanded")==="false"){this.open(key)}else{this.close(key)}};open=(key=0)=>{const trigger=this.triggers[key];const control=this.controls[key];const syncs=this.syncs[key];trigger.classList.add(this.settings.lockClass);trigger.setAttribute("aria-expanded","true");syncs.forEach(sync=>{sync.classList.add(this.settings.lockClass);sync.setAttribute("aria-expanded","true")});if(this.settings.mode==="tab"){trigger.setAttribute("aria-selected","true")}control.classList.add(this.settings.openClass);if(this.settings.height===true){control.style.height="0px"}setTimeout(()=>{if(this.settings.height===true){control.style.height=control.dataset.clickitHeight}},10);setTimeout(()=>{control.setAttribute("aria-hidden","false");control.classList.remove(this.settings.openClass);if(this.settings.mode==="modal"){control.setAttribute("aria-modal","true");control.setAttribute("role","dialog")}if(this.settings.height===true){control.style.height=""}trigger.classList.remove(this.settings.lockClass);syncs.forEach(sync=>{sync.classList.remove(this.settings.lockClass)})},this.settings.openDelay)};close=(key=0)=>{const trigger=this.triggers[key];const control=this.controls[key];const syncs=this.syncs[key];trigger.classList.add(this.settings.lockClass);trigger.setAttribute("aria-expanded","false");syncs.forEach(sync=>{sync.classList.add(this.settings.lockClass);sync.setAttribute("aria-expanded","false")});if(this.settings.mode==="tab"){trigger.setAttribute("aria-selected","false")}control.classList.add(this.settings.closeClass);if(this.settings.height===true){control.style.height=control.dataset.clickitHeight}setTimeout(()=>{if(this.settings.height===true){control.style.height="0px"}},10);setTimeout(()=>{control.setAttribute("aria-hidden","true");control.classList.remove(this.settings.closeClass);if(this.settings.mode==="modal"){control.removeAttribute("aria-modal");control.removeAttribute("role")}if(this.settings.height===true){control.style.height=""}trigger.classList.remove(this.settings.lockClass);syncs.forEach(sync=>{sync.classList.remove(this.settings.lockClass)})},this.settings.closeDelay)};openAll=()=>{this.triggers.forEach((trigger,i)=>{this.open(i)})};closeAll=()=>{this.triggers.forEach((trigger,i)=>{this.close(i)})};closeOther=current=>{this.triggers.forEach((trigger,i)=>{if(current!=i){this.close(i)}})};setHeight=(key=0)=>{let control=this.controls[key];setTimeout(()=>{control.dataset.clickitHeight=control.firstElementChild.clientHeight+"px"},500)}}